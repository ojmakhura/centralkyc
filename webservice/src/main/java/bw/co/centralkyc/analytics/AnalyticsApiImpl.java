// license-header java merge-point
//
// Attention: Generated code! Do not modify by hand!
// Generated by SpringWSImpl.java.vsl in andromda-webservices.
//
package bw.co.centralkyc.analytics;

import bw.co.centralkyc.individual.IndividualService;
import bw.co.centralkyc.individual.PepStatus;
import bw.co.centralkyc.invoice.KycInvoiceService;
import bw.co.centralkyc.keycloak.KeycloakOrganisationService;
import bw.co.centralkyc.kyc.KycComplianceStatus;
import bw.co.centralkyc.organisation.client.ClientRequestService;
import bw.co.centralkyc.subscription.KycSubscriptionService;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class AnalyticsApiImpl implements AnalyticsApi {
    protected final ClientRequestService clientRequestService;
    protected final IndividualService individualService;
    protected final KycSubscriptionService kycSubscriptionService;
    protected final KycInvoiceService kycInvoiceService;
    private final KeycloakOrganisationService keycloakOrganisationService;

    public AnalyticsApiImpl(
            ClientRequestService clientRequestService, IndividualService individualService,
            KycSubscriptionService kycSubscriptionService, KycInvoiceService kycInvoiceService,
            KeycloakOrganisationService keycloakOrganisationService) {

        this.clientRequestService = clientRequestService;
        this.individualService = individualService;
        this.kycSubscriptionService = kycSubscriptionService;
        this.kycInvoiceService = kycInvoiceService;
        this.keycloakOrganisationService = keycloakOrganisationService;
    }

    @Override
    public ResponseEntity<CountDTO> countAnalytics() throws Exception {
        try {

            CountDTO counts = new CountDTO();
            counts.setOrganisationCount(keycloakOrganisationService.countOrganisations());
            counts.setIndividualCount(individualService.count());
            counts.setRequestCount(clientRequestService.count());
            counts.setSubscriptionCount(kycSubscriptionService.count());
            counts.setPaidInvoicesCount(kycInvoiceService.countInvoices(true));
            counts.setUnpaidInvoicesCount(kycInvoiceService.countInvoices(false));
            counts.setInvoicesCount(kycInvoiceService.count());
            counts.setPepCount(individualService.countByPepStatus(PepStatus.PEP_SELF));
            counts.setPepRelativeCount(individualService.countByPepStatus(PepStatus.PEP_RELATIVE));
            counts.setPepAssociateCount(individualService.countByPepStatus(PepStatus.PEP_ASSOCIATE));
            counts.setKycComplianceExpiredCount(individualService.countByKycStatus(KycComplianceStatus.EXPIRED));
            counts.setKycComplianceAbsentCount(individualService.countByKycStatus(KycComplianceStatus.ABSENT));
            counts.setKycComplianceIncompleteCount(individualService.countByKycStatus(KycComplianceStatus.INCOMPLETE));

            return ResponseEntity.ok(counts);
        } catch (Exception e) {

            e.printStackTrace();
            throw e;
        }
    }

    @Override
    public ResponseEntity<CountDTO> organisationCountAnalytics(String organisationId) throws Exception {
        try {
            return ResponseEntity.ok(null);
        } catch (Exception e) {

            e.printStackTrace();
            throw e;
        }
    }

    /**
     * Gets the reference to <code>$serviceRef.daoName</code>.
     * 
     * @return clientRequestService
     */
    protected ClientRequestService getClientRequestService() {
        return this.clientRequestService;
    }

    /**
     * Gets the reference to <code>$serviceRef.daoName</code>.
     * 
     * @return individualService
     */
    protected IndividualService getIndividualService() {
        return this.individualService;
    }

    /**
     * Gets the reference to <code>$serviceRef.daoName</code>.
     * 
     * @return kycSubscriptionService
     */
    protected KycSubscriptionService getKycSubscriptionService() {
        return this.kycSubscriptionService;
    }

    /**
     * Gets the reference to <code>$serviceRef.daoName</code>.
     * 
     * @return kycInvoiceService
     */
    protected KycInvoiceService getKycInvoiceService() {
        return this.kycInvoiceService;
    }
}