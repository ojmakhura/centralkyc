<!-- Redesigned Settings Component -->
<div class="edit-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <mat-icon>settings</mat-icon>
        <span>{{ 'settings.title' | translate }}</span>
      </h1>
      <p class="page-subtitle">{{ 'system.configuration' | translate }}</p>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button
        mat-raised-button
        color="primary"
        (click)="editSettingsSave()"
        [disabled]="editSettingsForm.invalid || loading()"
        class="save-btn"
      >
        <mat-icon>save</mat-icon>
        <span>{{ 'save' | translate }}</span>
      </button>
      <button mat-button (click)="editSettingsFormReset()" [disabled]="loading()">
        <mat-icon>refresh</mat-icon>
        <span>{{ 'reset' | translate }}</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-overlay">
      <app-loader [isLoading]="loading()" [size]="2" [message]="loaderMessage()"></app-loader>
    </div>
  }

  <!-- Main Form Container -->
  <div class="form-container">
    <form [formGroup]="editSettingsForm" class="edit-form">
      <!-- General Settings Section -->
      <mat-card class="form-section">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>tune</mat-icon>
            {{ 'general.settings' | translate }}
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="field-row">
            <mat-form-field appearance="outline" class="field-full-width">
              <mat-label>{{ 'kyc.duration' | translate }}</mat-label>
              <input
                matInput
                type="number"
                id="kycDuration"
                formControlName="kycDuration"
                placeholder="{{ 'enter.kyc.duration' | translate }}"
                required
              />
              <mat-icon matSuffix>schedule</mat-icon>
              @if(kycDurationControl.hasError('required')) {
                <mat-error>{{ 'kyc.duration.required' | translate }}</mat-error>
              }
            </mat-form-field>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Invoice Template Section -->
      <mat-card class="form-section">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>receipt</mat-icon>
            {{ 'invoice.template' | translate }}
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <!-- Invoice Document Type Selection -->
          <div class="field-row">
            <mat-form-field appearance="outline" class="field-half">
              <mat-label>{{ 'invoice.document.type' | translate }}</mat-label>
              <mat-select id="invoiceDocumentType" formControlName="invoiceDocumentType" [compareWith]="invoiceDocumentTypeCompare">
                <mat-option>
                  <ngx-mat-select-search [placeholderLabel]="'Search'" [formControl]="invoiceDocumentTypeFilterCtrl"
                    [noEntriesFoundLabel]="'No Entries Found'"></ngx-mat-select-search>
                  <button mat-flat-button color="primary" (click)="filterInvoiceDocumentType()">Search</button>
                </mat-option>
                @for (item of invoiceDocumentTypeFilteredList(); track item) {
                  <mat-option [value]="item">{{ item?.name }}</mat-option>
                }
              </mat-select>
              <mat-icon matSuffix>category</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="field-half">
              <mat-label>{{ 'invoice.template.type' | translate }}</mat-label>
              <mat-select id="invoiceTemplateType" formControlName="invoiceTemplateType" [compareWith]="invoiceTemplateTypeCompare">
                <mat-option>
                  <ngx-mat-select-search [placeholderLabel]="'Search'" [formControl]="invoiceTemplateTypeFilterCtrl"
                    [noEntriesFoundLabel]="'No Entries Found'"></ngx-mat-select-search>
                  <button mat-flat-button color="primary" (click)="filterInvoiceTemplateType()">Search</button>
                </mat-option>
                @for (item of invoiceTemplateTypeFilteredList(); track item) {
                  <mat-option [value]="item">{{ item?.name }}</mat-option>
                }
              </mat-select>
              <mat-icon matSuffix>description</mat-icon>
            </mat-form-field>
          </div>

          <div class="field-row">
            <button mat-raised-button color="primary" (click)="attachInvoiceTemplate()" class="action-button">
              <mat-icon>attach_file</mat-icon>
              <span>{{ 'attach.template' | translate }}</span>
            </button>
          </div>

          @if (editSettingsForm.get('invoiceTemplate')?.value) {
            <div class="field-row">
              <div class="document-info">
                <mat-icon>insert_drive_file</mat-icon>
                <div class="document-details">
                  <span class="document-name">{{ editSettingsForm.get('invoiceTemplate.fileName')?.value || 'N/A' }}</span>
                  <!-- <span class="document-type">{{ editSettingsForm.get('invoiceTemplate.documentType')?.value || 'N/A' }}</span> -->
                </div>
                @if (editSettingsForm.get('invoiceTemplate.url')?.value) {
                  <a (click)="downloadTemplate(TargetEntityT.INVOICE)" target="_blank" mat-icon-button color="primary">
                    <mat-icon>download</mat-icon>
                  </a>
                }
              </div>
            </div>
          } @else {
            <div class="field-row">
              <div class="empty-state">
                <mat-icon>cloud_upload</mat-icon>
                <p>{{ 'no.invoice.template.attached' | translate }}</p>
              </div>
            </div>
          }
        </mat-card-content>
      </mat-card>

      <!-- Quotation Template Section -->
      <mat-card class="form-section">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>request_quote</mat-icon>
            {{ 'quotation.template' | translate }}
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <!-- Quotation Document Type Selection -->
          <div class="field-row">
            <mat-form-field appearance="outline" class="field-half">
              <mat-label>{{ 'quotation.document.type' | translate }}</mat-label>
              <mat-select id="quotationDocumentType" formControlName="quotationDocumentType" [compareWith]="quotationDocumentTypeCompare">
                <mat-option>
                  <ngx-mat-select-search [placeholderLabel]="'Search'" [formControl]="quotationDocumentTypeFilterCtrl"
                    [noEntriesFoundLabel]="'No Entries Found'"></ngx-mat-select-search>
                  <button mat-flat-button color="primary" (click)="filterQuotationDocumentType()">Search</button>
                </mat-option>
                @for (item of quotationDocumentTypeFilteredList(); track item) {
                  <mat-option [value]="item">{{ item?.name }}</mat-option>
                }
              </mat-select>
              <mat-icon matSuffix>category</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="field-half">
              <mat-label>{{ 'quotation.template.type' | translate }}</mat-label>
              <mat-select id="quotationTemplateType" formControlName="quotationTemplateType" [compareWith]="quotationTemplateTypeCompare">
                <mat-option>
                  <ngx-mat-select-search [placeholderLabel]="'Search'" [formControl]="quotationTemplateTypeFilterCtrl"
                    [noEntriesFoundLabel]="'No Entries Found'"></ngx-mat-select-search>
                  <button mat-flat-button color="primary" (click)="filterQuotationTemplateType()">Search</button>
                </mat-option>
                @for (item of quotationTemplateTypeFilteredList(); track item) {
                  <mat-option [value]="item">{{ item?.name }}</mat-option>
                }
              </mat-select>
              <mat-icon matSuffix>description</mat-icon>
            </mat-form-field>
          </div>

          <div class="field-row">
            <button mat-raised-button color="primary" (click)="attachQuotationTemplate()" class="action-button">
              <mat-icon>attach_file</mat-icon>
              <span>{{ 'attach.template' | translate }}</span>
            </button>
          </div>

          @if (editSettingsForm.get('quotationTemplate')?.value) {
            <div class="field-row">
              <div class="document-info">
                <mat-icon>insert_drive_file</mat-icon>
                <div class="document-details">
                  <span class="document-name">{{ editSettingsForm.get('quotationTemplate.fileName')?.value || 'N/A' }}</span>
                  <!-- <span class="document-type">{{ editSettingsForm.get('quotationTemplate.documentType')?.value || 'N/A' }}</span> -->
                </div>
                @if (editSettingsForm.get('quotationTemplate.url')?.value) {
                  <a (click)="downloadTemplate(TargetEntityT.QUOTATION)" target="_blank" mat-icon-button color="primary">
                    <mat-icon>download</mat-icon>
                  </a>
                }
              </div>
            </div>
          } @else {
            <div class="field-row">
              <div class="empty-state">
                <mat-icon>cloud_upload</mat-icon>
                <p>{{ 'no.quotation.template.attached' | translate }}</p>
              </div>
            </div>
          }
        </mat-card-content>
      </mat-card>

      <!-- Form Actions (Bottom) -->
      <div class="form-actions">
        <button
          mat-raised-button
          color="primary"
          type="submit"
          (click)="editSettingsSave()"
          [disabled]="editSettingsForm.invalid || loading()"
          class="action-primary"
        >
          <mat-icon>save</mat-icon>
          <span>{{ 'save' | translate }}</span>
        </button>

        <button
          mat-button
          type="button"
          (click)="editSettingsFormReset()"
          [disabled]="loading()"
          class="action-secondary"
        >
          <mat-icon>refresh</mat-icon>
          <span>{{ 'reset' | translate }}</span>
        </button>
      </div>
    </form>

    <!-- Document Types Configuration -->
    <mat-card class="form-section">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>folder_open</mat-icon>
          {{ 'document.types.configuration' | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-tab-group animationDuration="0ms" class="document-tabs">
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">business</mat-icon>
              <span translate>organisation.documents</span>
            </ng-template>
            <div class="tab-content">
              <div class="field-row">
                <mat-form-field appearance="outline" class="field-full-width">
                  <mat-label>{{ 'selected.org.document' | translate }}</mat-label>
                  <mat-select id="selectedOrgDocument" [compareWith]="selectedOrgDocumentCompare"
                    [formControl]="selectedOrgDocumentControl">
                    <mat-option>
                      <ngx-mat-select-search [placeholderLabel]="'Search'" [formControl]="selectedOrgDocumentFilterCtrl"
                        [noEntriesFoundLabel]="'No Entries Found'"></ngx-mat-select-search>
                      <button mat-flat-button color="primary" (click)="filterSelectedOrgDocument()">Search</button>
                    </mat-option>
                    @for (item of selectedOrgDocumentFilteredList(); track item) {
                      <mat-option [value]="item">{{ item[selectedOrgDocumentDisplays[0]] }}</mat-option>
                    }
                  </mat-select>
                  <mat-icon matSuffix>description</mat-icon>
                </mat-form-field>
              </div>

              <div class="field-row">
                <button mat-raised-button color="primary" (click)="onAddToOrgDocumentsClick()">
                  <mat-icon>add</mat-icon>
                  <span translate>add.to.org.documents</span>
                </button>
              </div>

              <div class="table-container">
                <app-table #organisationDocumentsTable [dataColumns]="documentsTableColumns"
                  [showActions]="showOrganisationDocumentsActions" [paged]="organisationDocumentsTablePaged"
                  [actions]="organisationDocumentsTableColumnsActions" [dataSignal]="organisationDocumentsTableSignal">
                </app-table>
              </div>
            </div>
          </mat-tab>

          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">verified_user</mat-icon>
              <span translate>org.kyc.documents</span>
            </ng-template>
            <div class="tab-content">
              <div class="field-row">
                <mat-form-field appearance="outline" class="field-full-width">
                  <mat-label>{{ 'selected.kyc.org.document' | translate }}</mat-label>
                  <mat-select id="selectedKycOrgDocument" [compareWith]="selectedKycOrgDocumentCompare"
                    [formControl]="selectedKycOrgDocumentControl">
                    <mat-option>
                      <ngx-mat-select-search [placeholderLabel]="'Search'" [formControl]="selectedKycOrgDocumentFilterCtrl"
                        (keyup.enter)="filterSelectedKycOrgDocument()"
                        [noEntriesFoundLabel]="'No Entries Found'"></ngx-mat-select-search>
                      <button mat-flat-button color="primary" (click)="filterSelectedKycOrgDocument()">Search</button>
                    </mat-option>
                    @for (item of selectedKycOrgDocumentFilteredList(); track item) {
                      <mat-option [value]="item">{{ item[selectedKycOrgDocumentDisplays[0]] }}</mat-option>
                    }
                  </mat-select>
                  <mat-icon matSuffix>description</mat-icon>
                </mat-form-field>
              </div>

              <div class="field-row">
                <button mat-raised-button color="primary" (click)="onAddToKycOrgDocumentsClick()">
                  <mat-icon>add</mat-icon>
                  <span translate>add.to.kyc.org.documents</span>
                </button>
              </div>

              <div class="table-container">
                <app-table #orgKycDocumentsTable [dataColumns]="documentsTableColumns" [showActions]="showOrgKycDocumentsActions"
                  [paged]="orgKycDocumentsTablePaged" [actions]="orgKycDocumentsTableColumnsActions"
                  [dataSignal]="orgKycDocumentsTableSignal">
                </app-table>
              </div>
            </div>
          </mat-tab>

          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">person</mat-icon>
              <span translate>individual.documents</span>
            </ng-template>
            <div class="tab-content">
              <div class="field-row">
                <mat-form-field appearance="outline" class="field-full-width">
                  <mat-label>{{ 'selected.ind.document' | translate }}</mat-label>
                  <mat-select id="selectedIndDocument" [compareWith]="selectedIndDocumentCompare"
                    [formControl]="selectedIndDocumentControl">
                    <mat-option>
                      <ngx-mat-select-search [placeholderLabel]="'Search'" [formControl]="selectedIndDocumentFilterCtrl"
                        (keyup.enter)="filterSelectedIndDocument()"
                        [noEntriesFoundLabel]="'No Entries Found'"></ngx-mat-select-search>
                      <button mat-flat-button color="primary" (click)="filterSelectedIndDocument()">Search</button>
                    </mat-option>
                    @for (item of selectedIndDocumentFilteredList(); track item) {
                      <mat-option [value]="item">{{ item[selectedIndDocumentDisplays[0]] }}</mat-option>
                    }
                  </mat-select>
                  <mat-icon matSuffix>description</mat-icon>
                </mat-form-field>
              </div>

              <div class="field-row">
                <button mat-raised-button color="primary" (click)="onAddToIndDocumentsClick()">
                  <mat-icon>add</mat-icon>
                  <span translate>add.to.ind.documents</span>
                </button>
              </div>

              <div class="table-container">
                <app-table #individualDocumentsTable [dataColumns]="documentsTableColumns"
                  [showActions]="showIndividualDocumentsActions" [paged]="individualDocumentsTablePaged"
                  [actions]="individualDocumentsTableColumnsActions" [dataSignal]="individualDocumentsTableSignal">
                </app-table>
              </div>
            </div>
          </mat-tab>

          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">badge</mat-icon>
              <span translate>ind.kyc.documents</span>
            </ng-template>
            <div class="tab-content">
              <div class="field-row">
                <mat-form-field appearance="outline" class="field-full-width">
                  <mat-label>{{ 'selected.kyc.ind.document' | translate }}</mat-label>
                  <mat-select id="selectedKycIndDocument" [compareWith]="selectedKycIndDocumentCompare"
                    [formControl]="selectedKycIndDocumentControl">
                    <mat-option>
                      <ngx-mat-select-search [placeholderLabel]="'Search'" [formControl]="selectedKycIndDocumentFilterCtrl"
                        (keyup.enter)="filterSelectedKycIndDocument()"
                        [noEntriesFoundLabel]="'No Entries Found'"></ngx-mat-select-search>
                      <button mat-flat-button color="primary" (click)="filterSelectedKycIndDocument()">Search</button>
                    </mat-option>
                    @for (item of selectedKycIndDocumentFilteredList(); track item) {
                      <mat-option [value]="item">{{ item[selectedKycIndDocumentDisplays[0]] }}</mat-option>
                    }
                  </mat-select>
                  <mat-icon matSuffix>description</mat-icon>
                </mat-form-field>
              </div>

              <div class="field-row">
                <button mat-raised-button color="primary" (click)="onAddToKycIndDocumentsClick()">
                  <mat-icon>add</mat-icon>
                  <span translate>add.to.kyc.ind.documents</span>
                </button>
              </div>

              <div class="table-container">
                <app-table #indKycDocumentsTable [dataColumns]="documentsTableColumns" [showActions]="showIndKycDocumentsActions"
                  [paged]="indKycDocumentsTablePaged" [actions]="indKycDocumentsTableColumnsActions"
                  [dataSignal]="indKycDocumentsTableSignal">
                </app-table>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>
      </mat-card-content>
    </mat-card>
  </div>
</div>
