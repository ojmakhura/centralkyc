<!-- Redesigned edit component using global styles -->
<div class="edit-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h2 class="page-title">
        <mat-icon>person</mat-icon>
        {{ 'edit.individual.title' | translate }}
      </h2>
    </div>
    <div class="action-buttons">
      <!-- <button mat-raised-button color="primary" class="save-btn" (click)="editIndividualSave()">
        <mat-icon>save</mat-icon>
        <span>{{ 'save' | translate }}</span>
      </button> -->
      <button mat-stroked-button color="primary" (click)="editIndividualSearch()">
        <mat-icon>search</mat-icon>
        <span>{{ 'search' | translate }}</span>
      </button>
      <!-- <button mat-stroked-button color="warn" (click)="editIndividualDelete()" *ngIf="deleteUnrestricted()">
        <mat-icon>delete</mat-icon>
        <span>{{ 'delete' | translate }}</span>
      </button> -->
      <!-- <button mat-stroked-button color="primary" (click)="editIndividualFormReset()">
        <mat-icon>restore</mat-icon>
        <span>{{ 'reset' | translate }}</span>
      </button> -->
    </div>
  </div>

  @if (loading()) {
    <div class="loading-overlay">
      <app-loader [isLoading]="loading()" [size]="2" [message]="loaderMessage()"></app-loader>
    </div>
  }

  <!-- Form Content -->
  <div class="form-container">
    <form [formGroup]="editIndividualForm" class="edit-form">
      <!-- Basic Information -->
      <mat-card class="form-section">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>info</mat-icon>
            {{ 'basic.information' | translate }}
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="field-row">
            <mat-form-field class="field-half">
              <mat-label id="identityType_label" for="identityType">
                <span translate>identity.type</span>
              </mat-label>
              <mat-select id="identityType" formControlName="identityType" required>
                <mat-option></mat-option>
                @for (key of IndividualIdentityTypeOptions; track key) {
                  <mat-option [value]="key">{{ IndividualIdentityTypeT[key] }}</mat-option>
                }
              </mat-select>
              @if (identityTypeControl.hasError('required')) {
                <mat-error translate>identity.type.required</mat-error>
              }
            </mat-form-field>

            <mat-form-field class="field-half">
              <mat-label id="identityNo_label" for="identityNo">
                <span translate>identity.no</span>
              </mat-label>
              <input matInput type="text" id="identityNo" name="identityNo" formControlName="identityNo" required />
              @if (identityNoControl.hasError('required')) {
                <mat-error translate>identity.no.required</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="field-row">
            <mat-form-field class="field-half">
              <mat-label id="firstName_label" for="firstName">
                <span translate>first.name</span>
              </mat-label>
              <input matInput type="text" id="firstName" name="firstName" formControlName="firstName" required />
              @if (firstNameControl.hasError('required')) {
                <mat-error translate>first.name.required</mat-error>
              }
            </mat-form-field>

            <mat-form-field class="field-half">
              <mat-label id="middleName_label" for="middleName">
                <span translate>middle.name</span>
              </mat-label>
              <input matInput type="text" id="middleName" name="middleName" formControlName="middleName" />
            </mat-form-field>
          </div>

          <div class="field-row">
            <mat-form-field class="field-half">
              <mat-label id="surname_label" for="surname">
                <span translate>surname</span>
              </mat-label>
              <input matInput type="text" id="surname" name="surname" formControlName="surname" required />
              @if (surnameControl.hasError('required')) {
                <mat-error translate>surname.required</mat-error>
              }
            </mat-form-field>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Contact Information -->
      <mat-card class="form-section">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>contact_phone</mat-icon>
            {{ 'contact.information' | translate }}
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="field-row">
            <mat-form-field class="field-half">
              <mat-label id="phoneNumbers_label" for="phoneNumbers">
                <span translate>phone.numbers</span>
              </mat-label>
              <input matInput type="text" id="phoneNumbers" name="phoneNumbers" formControlName="phoneNumbers" />
            </mat-form-field>

            <mat-form-field class="field-half">
              <mat-label id="emailAddress_label" for="emailAddress">
                <span translate>email.address</span>
              </mat-label>
              <input matInput type="text" id="emailAddress" name="emailAddress" formControlName="emailAddress" />
            </mat-form-field>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Addresses -->
      <mat-card class="form-section">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>home</mat-icon>
            {{ 'addresses' | translate }}
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="field-row">
            <mat-form-field class="field-half">
              <mat-label id="postalAddress_label" for="postalAddress">
                <span translate>postal.address</span>
              </mat-label>
              <textarea matInput id="postalAddress" formControlName="postalAddress"></textarea>
            </mat-form-field>

            <mat-form-field class="field-half">
              <mat-label id="physicalAddress_label" for="physicalAddress">
                <span translate>physical.address</span>
              </mat-label>
              <textarea matInput id="physicalAddress" formControlName="physicalAddress"></textarea>
            </mat-form-field>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- User & Organisation -->
      <mat-card class="form-section">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>group</mat-icon>
            {{ 'user.and.organisation' | translate }}
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="field-row">
            <mat-checkbox id="hasUser" formControlName="hasUser" required>
              <span translate>has.user</span>
            </mat-checkbox>
          </div>

          @if (hasUserControl.value) {
            <div class="field-row">
              <mat-form-field class="field-half">
                <mat-label id="organisation_label" for="organisation">
                  <span translate>organisation</span>
                </mat-label>
                <mat-select id="organisation" [compareWith]="organisationCompare" formControlName="organisation">
                  <mat-option>
                    <ngx-mat-select-search
                      [placeholderLabel]="'Search'"
                      [formControl]="organisationFilterCtrl"
                      (keyup.enter)="filterOrganisation()"
                      [noEntriesFoundLabel]="'No Entries Found'"
                    ></ngx-mat-select-search>
                  </mat-option>
                  @for (item of organisationApiStore.dataList(); track item.id) {
                    <mat-option [value]="item">{{ item[organisationDisplays[0]] }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          }

          @if (organisationControl.value?.id) {
            <div class="field-row">
              <mat-form-field class="field-half">
                <mat-label id="branch_label" for="branch">
                  <span translate>branch</span>
                </mat-label>
                <mat-select id="branch" [compareWith]="branchCompare" formControlName="branch">
                  <mat-option>
                    <ngx-mat-select-search
                      [placeholderLabel]="'Search'"
                      [formControl]="branchFilterCtrl"
                      (keyup.enter)="filterBranch()"
                      [noEntriesFoundLabel]="'No Entries Found'"
                    ></ngx-mat-select-search>
                  </mat-option>
                  @for (item of branchApiStore.dataList(); track item.id) {
                    <mat-option [value]="item">{{ item[branchDisplays[0]] }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          }
        </mat-card-content>
      </mat-card>

      <!-- Form Actions (Bottom) -->
      <div class="form-actions">
        <button mat-raised-button color="primary" class="action-primary" (click)="editIndividualSave()">
          <mat-icon>save</mat-icon>
          <span>{{ 'save' | translate }}</span>
        </button>
        <!-- <button mat-stroked-button color="primary" class="action-secondary" (click)="editIndividualSearch()">
          <mat-icon>search</mat-icon>
          <span>{{ 'search' | translate }}</span>
        </button> -->
        <button
          mat-stroked-button
          color="warn"
          class="action-secondary"
          (click)="editIndividualDelete()"
          *ngIf="deleteUnrestricted()"
        >
          <mat-icon>delete</mat-icon>
          <span>{{ 'delete' | translate }}</span>
        </button>
        <button mat-stroked-button (click)="editIndividualFormReset()" class="action-secondary">
          <mat-icon>restore</mat-icon>
          <span>{{ 'reset' | translate }}</span>
        </button>
      </div>
    </form>
  </div>
</div>
