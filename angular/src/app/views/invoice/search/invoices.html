<!-- Redesigned Invoice Details Component -->
<div class="details-container">
  <div class="details-container">
    <div class="breadcrumb-section">
    <mat-icon class="breadcrumb-icon">home</mat-icon>
    <span class="breadcrumb-text">{{ 'home' | translate }}</span>
    <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
    <span class="breadcrumb-text">{{ 'invoice' | translate }}</span>
    <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
    <span class="breadcrumb-text active">{{ kycInvoice()?.ref || 'N/A' }} </span>
  </div>
  <!-- Header Section -->
  <mat-card class="header-card" appearance="outlined">
    <mat-card-header>
      <div class="header-content">
        <div class="title-section">
          <mat-icon class="title-icon">receipt</mat-icon>
          <div class="title-text">
            <h1 class="item-title">{{ 'invoice.details' | translate }}</h1>
            <p class="item-subtitle">{{ kycInvoice()?.ref || 'N/A' }}</p>
          </div>
        </div>

        <div class="action-buttons">
          <button mat-raised-button color="primary" (click)="invoiceDetailsEdit()" class="action-button">
            <mat-icon>edit</mat-icon>
            {{ 'edit' | translate }}
          </button>
          <button mat-stroked-button color="primary" (click)="invoiceDetailsFormReset()" class="action-button">
            <mat-icon>refresh</mat-icon>
            {{ 'reset' | translate }}
          </button>
        </div>
      </div>
    </mat-card-header>
  </mat-card>

  <!-- Loading State -->
  @if (loading()) {
  <div class="loading-container">
    <app-loader [isLoading]="loading()" [size]="'medium'" [message]="loaderMessage()"></app-loader>
  </div>
  }

  <!-- Main Content -->
  <div class="item-display">
    <!-- Payment Status Section -->
    <mat-card class="section-card status-section" appearance="outlined">
      <mat-card-content>
        <div class="display-item">
          <div class="display-label">
            <mat-icon class="field-icon">payment</mat-icon>
            <span>{{ 'paid' | translate }}</span>
          </div>
          <div class="display-value">
            <mat-chip class="status-chip" [ngClass]="kycInvoice()?.paid ? 'status-paid' : 'status-unpaid'">
              {{ (kycInvoice()?.paid ? 'paid' : 'unpaid') | translate }}
            </mat-chip>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Basic Information Section -->
    <mat-card class="section-card basic-info-section" appearance="outlined">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="section-icon">info</mat-icon>
          Organisation Information
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="display-grid">

          <div class="display-item">
            <div class="display-label">
              <mat-icon class="field-icon">business</mat-icon>
              <span>{{ 'organisation.registration.no' | translate }}</span>
            </div>
            <div class="display-value">
              {{ kycInvoice()?.organisationRegistrationNo || 'N/A' }}
            </div>
          </div>

          <div class="display-item">
            <div class="display-label">
              <mat-icon class="field-icon">tag</mat-icon>
              <span>{{ 'organisation.code' | translate }}</span>
            </div>
            <div class="display-value">
              {{ kycInvoice()?.organisationCode || 'N/A' }}
            </div>
          </div>

          <div class="display-item">
            <div class="display-label">
              <mat-icon class="field-icon">domain</mat-icon>
              <span>{{ 'organisation.name' | translate }}</span>
            </div>
            <div class="display-value">
              {{ kycInvoice()?.organisationName || 'N/A' }}
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="section-card basic-info-section" appearance="outlined">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="section-icon">info</mat-icon>
          {{ 'basic.information' | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="display-grid">
          <div class="display-item">
            <div class="display-label">
              <mat-icon class="field-icon">confirmation_number</mat-icon>
              <span>{{ 'ref' | translate }}</span>
            </div>
            <div class="display-value primary-value">
              {{ kycInvoice()?.ref || 'N/A' }}
            </div>
          </div>

          <div class="display-item">
            <div class="display-label">
              <mat-icon class="field-icon">payments</mat-icon>
              <span>{{ 'amount' | translate }}</span>
            </div>
            <div class="display-value primary-value">
              {{ (kycInvoice()?.amount | currency: 'BWP') || 'N/A' }}
            </div>
          </div>

          <div class="display-item">
            <div class="display-label">
              <mat-icon class="field-icon">receipt_long</mat-icon>
              <span>{{ 'payment.reference' | translate }}</span>
            </div>
            <div class="display-value">
              {{ kycInvoice()?.paymentReference || 'N/A' }}
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Invoice Documents Section -->
    <mat-card class="section-card documents-section" appearance="outlined">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="section-icon">folder_shared</mat-icon>
          {{ 'invoice.documents' | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="grid-2">
          <!-- Invoice Document -->
          <div class="document-item">
            <div class="document-info">
              <mat-icon>description</mat-icon>
              <div class="document-details">
                <div class="document-name">{{ 'invoice.document' | translate }}</div>
                <div class="document-type">{{ kycInvoice()?.invoiceDocument?.documentType || 'Invoice' }}</div>
              </div>
              <button mat-stroked-button color="primary" (click)="attachInvoiceDocument()">
                <mat-icon>{{ kycInvoice()?.invoiceDocument ? 'edit' : 'attach_file' }}</mat-icon>
                {{ (kycInvoice()?.invoiceDocument ? 'update' : 'attach') | translate }}
              </button>
            </div>

            @if (kycInvoice()?.invoiceDocument) {
            <div class="document-info" style="margin-top: 12px;">
              <mat-icon>insert_drive_file</mat-icon>
              <div class="document-details">
                <div class="document-name">{{ kycInvoice()?.invoiceDocument?.fileName || 'N/A' }}</div>
                <div class="document-type">{{ TargetEntityT[kycInvoice()?.invoiceDocument?.target] || 'Document' }}</div>
              </div>
              @if (kycInvoice()?.invoiceDocument?.url) {
              <a [href]="kycInvoice()?.invoiceDocument?.url" target="_blank" mat-icon-button color="primary" matTooltip="{{ 'download' | translate }}">
                <mat-icon>download</mat-icon>
              </a>
              }
            </div>
            } @else {
            <div class="empty-state" style="margin-top: 12px;">
              <mat-icon>cloud_upload</mat-icon>
              <p>{{ 'no.document.attached' | translate }}</p>
            </div>
            }
          </div>

          <!-- Proof of Payment -->
          <div class="document-item">
            <div class="document-info">
              <mat-icon>verified</mat-icon>
              <div class="document-details">
                <div class="document-name">{{ 'proof.of.payment' | translate }}</div>
                <div class="document-type">{{ kycInvoice()?.proofOfPayment?.documentType || 'Payment Proof' }}</div>
              </div>
              <button mat-stroked-button color="primary" (click)="attachProofOfPayment()">
                <mat-icon>{{ kycInvoice()?.proofOfPayment ? 'edit' : 'attach_file' }}</mat-icon>
                {{ (kycInvoice()?.proofOfPayment ? 'update' : 'attach') | translate }}
              </button>
            </div>

            @if (kycInvoice()?.proofOfPayment) {
            <div class="document-info" style="margin-top: 12px;">
              <mat-icon>insert_drive_file</mat-icon>
              <div class="document-details">
                <div class="document-name">{{ kycInvoice()?.proofOfPayment?.fileName || 'N/A' }}</div>
                <div class="document-type">{{ TargetEntityT[kycInvoice()?.proofOfPayment?.target] || 'Document' }}</div>
              </div>
              @if (kycInvoice()?.proofOfPayment?.url) {
              <a [href]="kycInvoice()?.proofOfPayment?.url" target="_blank" mat-icon-button color="primary" matTooltip="{{ 'download' | translate }}">
                <mat-icon>download</mat-icon>
              </a>
              }
            </div>
            } @else {
            <div class="empty-state" style="margin-top: 12px;">
              <mat-icon>cloud_upload</mat-icon>
              <p>{{ 'no.proof.of.payment.attached' | translate }}</p>
            </div>
            }
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
