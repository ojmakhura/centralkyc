<!-- Redesigned Organisation Details Component - Display Only -->
@defer (when organisation()) {
<div class="details-container">
  <div class="breadcrumb-section">
    <mat-icon class="breadcrumb-icon">home</mat-icon>
    <span class="breadcrumb-text">{{ 'home' | translate }}</span>
    <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
    <span class="breadcrumb-text">{{ 'organisation' | translate }}</span>
    <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
    <span class="breadcrumb-text active">{{ organisation().name }} </span>
  </div>
  <!-- Header Section -->
  <mat-card class="header-card" appearance="outlined">
    <mat-card-header>
      <div class="header-content">
        <div class="title-section">
          <mat-icon class="title-icon">business</mat-icon>
          <div class="title-text">
            <h1 class="item-title">{{ organisation().name }}</h1>
          </div>
        </div>

        <div class="action-buttons">
          <button mat-raised-button color="primary" (click)="organisationDetailsEdit()" class="action-button">
            <mat-icon>edit</mat-icon>
            {{ 'edit' | translate }}
          </button>
          <button mat-stroked-button color="primary" (click)="organisationDetailsFormReset()" class="action-button">
            <mat-icon>refresh</mat-icon>
            {{ 'refresh' | translate }}
          </button>
        </div>
      </div>
    </mat-card-header>
  </mat-card>

  <!-- Loading State -->
  @if (loading()) {
  <div class="loading-container">
    <app-loader [isLoading]="loading()" [size]="'medium'" [message]="loaderMessage()"></app-loader>
  </div>
  }

  <!-- Main Content -->
  <div class="item-display">
    <!-- Status Section -->
    <mat-card class="section-card status-section" appearance="outlined">
      <mat-card-content>
        <div class="display-item">
          <div class="display-label">
            <mat-icon class="field-icon">flag</mat-icon>
            <span>{{ 'status' | translate }}</span>
          </div>
          <div class="display-value">
            <mat-chip class="status-chip" [ngClass]="'status-' + organisation().status">
              {{ GeneralStatusT[organisation().status] || 'N/A' }}
            </mat-chip>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Basic Information Section -->
    <mat-card class="section-card basic-info-section" appearance="outlined">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="section-icon">business_center</mat-icon>
          {{ 'basic.information' | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="display-grid">
          <div class="display-item">
            <div class="display-label">
              <mat-icon class="field-icon">assignment</mat-icon>
              <span>{{ 'registration.no' | translate }}</span>
            </div>
            <div class="display-value">
              {{ organisation().registrationNo || 'N/A' }}
            </div>
          </div>

          <div class="display-item">
            <div class="display-label">
              <mat-icon class="field-icon">qr_code</mat-icon>
              <span>{{ 'code' | translate }}</span>
            </div>
            <div class="display-value">
              {{ organisation().code || 'N/A' }}
            </div>
          </div>
          <div class="display-item full-width">
            <div class="display-label">
              <mat-icon class="field-icon">description</mat-icon>
              <span>{{ 'description' | translate }}</span>
            </div>
            <div class="display-value description-value">
              {{ organisation().description || 'N/A' }}
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Contact Information Section -->
    <mat-card class="section-card contact-info-section" appearance="outlined">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="section-icon">contact_phone</mat-icon>
          {{ 'contact.information' | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="display-item full-width">
          <div class="display-label">
            <mat-icon class="field-icon">phone</mat-icon>
            <span>{{ 'phone.numbers' | translate }}</span>
          </div>
          @for(phone of organisation().phoneNumbers; track phone.phoneNumber) {
          <!-- <div class="row"> -->
            <div class="display-value">
              <div class="phone-numbers">
                {{ phone.type }}: {{ phone.phoneNumber || 'N/A' }}
              </div>
            </div>
          <!-- </div> -->
          }
        </div>
        <div class="display-item full-width">
          <div class="display-label">
            <mat-icon class="field-icon">description</mat-icon>
            <span>{{ 'contact.email.address' | translate }}</span>
          </div>
          <div class="display-value description-value">
            {{ organisation().contactEmailAddress || 'N/A' }}
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Address Information Section -->
    <mat-card class="section-card address-info-section" appearance="outlined">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="section-icon">location_on</mat-icon>
          {{ 'address.information' | translate }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="address-display">
          <div class="display-item">
            <div class="display-label">
              <mat-icon class="field-icon">mail</mat-icon>
              <span>{{ 'postal.address' | translate }}</span>
            </div>
            <div class="display-value address-value">
              {{ organisation().postalAddress || 'N/A' }}
            </div>
          </div>

          <div class="display-item">
            <div class="display-label">
              <mat-icon class="field-icon">place</mat-icon>
              <span>{{ 'physical.address' | translate }}</span>
            </div>
            <div class="display-value address-value">
              {{ organisation().physicalAddress || 'N/A' }}
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Tabbed Sections -->
    <mat-card class="section-card tabs-section" appearance="outlined">
      <mat-card-content>
        <mat-tab-group>
          <!-- Branches Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">account_tree</mat-icon>
              {{ 'organisation.branches' | translate }}
            </ng-template>
            <div class="tab-content">
              <div class="tab-header">
                <div class="branch-actions">
                  <button mat-raised-button color="accent" (click)="addNewBranch()" class="branch-action-button">
                    <mat-icon>add</mat-icon>
                    {{ 'add.branch' | translate }}
                  </button>
                  <button mat-stroked-button color="primary" (click)="refreshBranches()" class="branch-action-button">
                    <mat-icon>refresh</mat-icon>
                    {{ 'refresh' | translate }}
                  </button>
                </div>
              </div>
              @if (branchesLoading()) {
              <div class="branches-loading">
                <app-loader [isLoading]="branchesLoading()" [size]="'small'"
                  [message]="'Loading branches...' | translate"></app-loader>
              </div>
              } @else if (branches() && branches().length > 0) {
              <app-table #organisationsTable [dataColumns]="branchesTableColumns" [showActions]="true" [paged]="branchTablePaged()"
                [actions]="branchesTableColumnsActions" (actionClicked)="branchesTableActionClicked($event)"
                [dataSignal]="branches">
              </app-table>
              } @else {
              <div class="no-branches">
                <div class="no-branches-content">
                  <mat-icon class="no-branches-icon">account_tree</mat-icon>
                  <h3>{{ 'no.branches.found' | translate }}</h3>
                  <p>{{ 'no.branches.message' | translate }}</p>
                  <button mat-raised-button color="primary" (click)="addNewBranch()" class="add-first-branch-button">
                    <mat-icon>add</mat-icon>
                    {{ 'add.first.branch' | translate }}
                  </button>
                </div>
              </div>
              }
            </div>
          </mat-tab>

          <!-- Invoices Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">receipt</mat-icon>
              {{ 'invoices' | translate }}
            </ng-template>
            <div class="tab-content">
              <div class="tab-header">
                <div class="invoice-actions">
                  <button mat-stroked-button color="primary" (click)="refreshInvoices()" class="action-button">
                    <mat-icon>refresh</mat-icon>
                    {{ 'refresh' | translate }}
                  </button>
                </div>
              </div>
              @if (invoicesLoading()) {
              <div class="invoices-loading">
                <app-loader [isLoading]="invoicesLoading()" [size]="'small'"
                  [message]="'Loading invoices...' | translate"></app-loader>
              </div>
              } @else if (invoices() && invoices().length > 0) {
              <app-table #invoicesTable [dataColumns]="invoicesTableColumns" [showActions]="true" [paged]="false"
                [actions]="invoicesTableColumnsActions" (actionClicked)="invoicesTableActionClicked($event)"
                [dataSignal]="invoices">
              </app-table>
              } @else {
              <div class="no-invoices">
                <div class="no-content">
                  <mat-icon class="no-content-icon">receipt</mat-icon>
                  <h3>{{ 'no.invoices.found' | translate }}</h3>
                  <p>{{ 'no.invoices.message' | translate }}</p>
                </div>
              </div>
              }
            </div>
          </mat-tab>

          <!-- Subscriptions Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">card_membership</mat-icon>
              {{ 'subscriptions' | translate }}
            </ng-template>
            <div class="tab-content">
              <div class="tab-header">
                <div class="subscription-actions">
                  <button mat-stroked-button color="primary" (click)="refreshSubscriptions()" class="action-button">
                    <mat-icon>refresh</mat-icon>
                    {{ 'refresh' | translate }}
                  </button>
                </div>
              </div>
              @if (subscriptionsLoading()) {
              <div class="subscriptions-loading">
                <app-loader [isLoading]="subscriptionsLoading()" [size]="'small'"
                  [message]="'Loading subscriptions...' | translate"></app-loader>
              </div>
              } @else if (subscriptions() && subscriptions().length > 0) {
              <app-table #subscriptionsTable [dataColumns]="subscriptionsTableColumns" [showActions]="true"
                [paged]="false" [actions]="subscriptionsTableColumnsActions"
                (actionClicked)="subscriptionsTableActionClicked($event)" [dataSignal]="subscriptions">
              </app-table>
              } @else {
              <div class="no-subscriptions">
                <div class="no-content">
                  <mat-icon class="no-content-icon">card_membership</mat-icon>
                  <h3>{{ 'no.subscriptions.found' | translate }}</h3>
                  <p>{{ 'no.subscriptions.message' | translate }}</p>
                </div>
              </div>
              }
            </div>
          </mat-tab>

          <!-- Individual Client Requests Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">person</mat-icon>
              {{ 'individual.client.requests' | translate }}
            </ng-template>
            <div class="tab-content">
              <div class="tab-header">
                <div class="actions-group">
                  <div class="primary-actions">
                    <button mat-raised-button color="accent" (click)="addNewClientRequest(TargetEntityT.INDIVIDUAL)">
                      <mat-icon>add</mat-icon>
                      <span>{{ 'add.individual.request' | translate }}</span>
                    </button>
                    <button mat-stroked-button color="primary" (click)="downloadIndividualRequestTemplate()">
                      <mat-icon>download</mat-icon>
                      <span>{{ 'download.template' | translate }}</span>
                    </button>
                    <input type="file" #individualClientRequestFileInput (change)="onIndividualClientRequestFileSelected($event)"
                      accept=".csv,.xlsx,.xls" style="display: none" />
                    <button mat-raised-button color="primary" (click)="individualClientRequestFileInput.click()">
                      <mat-icon>upload_file</mat-icon>
                      <span>{{ 'upload.bulk.requests' | translate }}</span>
                    </button>
                  </div>
                  <div class="secondary-actions">
                    <button mat-icon-button matTooltip="{{ 'refresh' | translate }}" (click)="refreshIndividualClientRequests()">
                      <mat-icon>refresh</mat-icon>
                    </button>
                  </div>
                </div>
              </div>

              @if (isUploadingIndividualClientRequestFile()) {
              <div class="field-row">
                <mat-progress-bar mode="determinate" [value]="individualClientRequestFileUploadProgress()"></mat-progress-bar>
              </div>
              }

              @if (individualClientRequestsLoading()) {
              <div class="loading-state">
                <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
                <p>{{ 'loading.individual.client.requests' | translate }}</p>
              </div>
              } @else if (individualClientRequests() && (individualClientRequests().page.totalElements || individualClientRequests().numberOfElements || 0) > 0) {
              <app-table #individualClientRequestsTable [dataColumns]="individualClientRequestsTableColumns"
                [showActions]="showClientRequestsActions" [paged]="true"
                [actions]="clientRequestsTableColumnsActions" [dataSignal]="individualClientRequests">
              </app-table>

              } @else {
              <div class="empty-state">
                <div class="empty-state-content">
                  <mat-icon class="empty-icon">person</mat-icon>
                  <h3>{{ 'no.individual.client.requests.found' | translate }}</h3>
                  <p>{{ 'no.individual.client.requests.message' | translate }}</p>
                </div>
              </div>
              }
            </div>
          </mat-tab>

          <!-- Organisation Client Requests Tab -->
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="tab-icon">business</mat-icon>
              {{ 'organisation.client.requests' | translate }}
            </ng-template>
            <div class="tab-content">
              <div class="tab-header">
                <div class="actions-group">
                  <div class="primary-actions">
                    <button mat-raised-button color="accent" (click)="addNewClientRequest(TargetEntityT.ORGANISATION)">
                      <mat-icon>add</mat-icon>
                      <span>{{ 'add.organisation.request' | translate }}</span>
                    </button>
                    <button mat-stroked-button color="primary" (click)="downloadOrganisationRequestTemplate()">
                      <mat-icon>download</mat-icon>
                      <span>{{ 'download.template' | translate }}</span>
                    </button>
                    <input type="file" #organisationClientRequestFileInput (change)="onOrganisationClientRequestFileSelected($event)"
                      accept=".csv,.xlsx,.xls" style="display: none" />
                    <button mat-raised-button color="primary" (click)="organisationClientRequestFileInput.click()">
                      <mat-icon>upload_file</mat-icon>
                      <span>{{ 'upload.bulk.requests' | translate }}</span>
                    </button>
                  </div>
                  <div class="secondary-actions">
                    <button mat-icon-button matTooltip="{{ 'refresh' | translate }}" (click)="refreshOrganisationClientRequests()">
                      <mat-icon>refresh</mat-icon>
                    </button>
                  </div>
                </div>
              </div>

              @if (isUploadingOrganisationClientRequestFile()) {
              <div class="field-row">
                <mat-progress-bar mode="determinate" [value]="organisationClientRequestFileUploadProgress()"></mat-progress-bar>
              </div>
              }

              @if (organisationClientRequestsLoading()) {
              <div class="loading-state">
                <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
                <p>{{ 'loading.organisation.client.requests' | translate }}</p>
              </div>
              } @else if (organisationClientRequests() && (organisationClientRequests()?.page?.totalElements || organisationClientRequests()?.numberOfElements || 0) > 0) {
              <app-table #organisationClientRequestsTable [dataColumns]="clientRequestsTableColumns"
                [showActions]="showClientRequestsActions" [paged]="true"
                [actions]="clientRequestsTableColumnsActions" [dataSignal]="organisationClientRequests">
              </app-table>

              } @else {
              <div class="empty-state">
                <div class="empty-state-content">
                  <mat-icon class="empty-icon">business</mat-icon>
                  <h3>{{ 'no.organisation.client.requests.found' | translate }}</h3>
                  <p>{{ 'no.organisation.client.requests.message' | translate }}</p>
                </div>
              </div>
              }
            </div>
          </mat-tab>
        </mat-tab-group>
      </mat-card-content>
    </mat-card>
  </div>
</div>
}
